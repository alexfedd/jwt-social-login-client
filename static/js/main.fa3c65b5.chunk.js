(this["webpackJsonpjwt-social-login-client"]=this["webpackJsonpjwt-social-login-client"]||[]).push([[0],{240:function(e,t,a){e.exports=a(505)},268:function(e,t,a){},269:function(e,t,a){},385:function(e,t,a){},386:function(e,t,a){},436:function(e,t,a){},504:function(e,t,a){},505:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(5),o=a.n(r),s=a(32),l=a(218),i=(a(268),a(381)),m=a(30),u=a(514),d=a(509),g=a(512),p=a(49),f=a(515),E=a(516),h=a(517),v="http://78.24.223.206:8082",b=function(e){var t=new Headers;!1!==e.setContentType&&t.append("Content-Type","application/json"),localStorage.getItem("accessToken")&&t.append("Authorization","Bearer "+localStorage.getItem("accessToken"));var a={headers:t};return e=Object.assign({},a,e),fetch(e.url,e).then((function(e){return null===e||void 0===e?void 0:e.json().then((function(t){return e.ok?t:Promise.reject(t)}))}))};a(269);var y=a(56),S=function(e){var t=Object(n.useState)(!1),a=Object(m.a)(t,2),r=a[0],o=a[1];Object(n.useEffect)((function(){null!==localStorage.getItem("accessToken")&&e.history.push("/")}),[]);return c.a.createElement("div",{className:"login-container"},c.a.createElement(f.a,{style:{fontSize:50}}),c.a.createElement(d.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:function(t){var a;o(!0),(a=t,b({url:v+"/auth/sign-in",method:"POST",body:JSON.stringify(a)})).then((function(t){localStorage.setItem("accessToken",t.token),e.history.push("/"),o(!1)})).catch((function(e){401===e.status?u.a.error({message:"Error",description:"Username or Password is incorrect. Please try again!"}):u.a.error({message:"Error",description:e.message||"Sorry! Something went wrong. Please try again!"}),o(!1)}))}},c.a.createElement(d.a.Item,{name:"username",rules:[{required:!0,message:"Please input your Username!"}]},c.a.createElement(g.a,{size:"large",prefix:c.a.createElement(E.a,{className:"site-form-item-icon"}),placeholder:"Username"})),c.a.createElement(d.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"}]},c.a.createElement(g.a,{size:"large",prefix:c.a.createElement(h.a,{className:"site-form-item-icon"}),type:"password",placeholder:"Password"})),c.a.createElement(d.a.Item,null,c.a.createElement(p.a,{shape:"round",size:"large",htmlType:"submit",className:"login-form-button",loading:r},"Log in")),"Not a member yet? ",c.a.createElement(y.Link,{to:"/signup"},"Sign up")))},O=(a(385),function(e){var t=Object(n.useState)(!1),a=Object(m.a)(t,2),r=a[0],o=a[1];Object(n.useEffect)((function(){null!==localStorage.getItem("accessToken")&&e.history.push("/")}),[]);return c.a.createElement("div",{className:"login-container"},c.a.createElement(f.a,{style:{fontSize:50}}),c.a.createElement(d.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:function(t){var a;o(!0),(a=t,b({url:v+"/auth/sign-up",method:"POST",body:JSON.stringify(a)})).then((function(t){u.a.success({message:"Success",description:"Thank you! You're successfully registered. Please Login to continue!"}),console.log(t),localStorage.setItem("accessToken",null===t||void 0===t?void 0:t.token),e.history.push("/login"),o(!1)})).catch((function(e){u.a.error({message:"Error",description:e.message||"Sorry! Something went wrong. Please try again!"}),o(!1)}))}},c.a.createElement(d.a.Item,{name:"username",rules:[{required:!0,message:"Please input your Username!"}]},c.a.createElement(g.a,{size:"large",placeholder:"Username"})),c.a.createElement(d.a.Item,{name:"email",rules:[{required:!0,message:"Please input your email!"}]},c.a.createElement(g.a,{size:"large",placeholder:"Email"})),c.a.createElement(d.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"}]},c.a.createElement(g.a,{size:"large",type:"password",placeholder:"Password"})),c.a.createElement(d.a.Item,null,c.a.createElement(p.a,{shape:"round",size:"large",htmlType:"submit",className:"login-form-button",loading:r},"Signup")),"Already a member? ",c.a.createElement(y.Link,{to:"/login"},"Log in")))}),k=a(510),j=a(507),N=Object(s.atom)({key:"loggedInUser",default:{},persistence_UNSTABLE:{type:"loggedInUser"}}),w=(Object(s.atom)({key:"chatActiveContact",persistence_UNSTABLE:{type:"chatActiveContact"}}),Object(s.atom)({key:"chatMessages",default:[],persistence_UNSTABLE:{type:"chatMessages"}}),a(518)),T=a(78),P=a.n(T),I=(a(386),k.a.Meta),C=function(e){var t=Object(s.useRecoilState)(N),a=Object(m.a)(t,2),r=a[0],o=a[1];Object(n.useEffect)((function(){null===localStorage.getItem("accessToken")&&e.history.push("/login"),l()}),[]);var l=function(){(localStorage.getItem("accessToken")?b({url:v+"/auth/who-am-i",method:"POST"}):Promise.reject("No access token set.")).then((function(e){o(e)})).catch((function(e){console.log(e)}))};return c.a.createElement("div",{className:"profile-container"},c.a.createElement(k.a,{style:{width:420,border:"1px solid #e1e0e0"},actions:[c.a.createElement(w.a,{onClick:function(){localStorage.removeItem("accessToken"),e.history.push("/login")}})]},c.a.createElement(I,{avatar:c.a.createElement(j.a,{src:P.a,className:"user-avatar-circle"}),title:r.username,description:"@"+r.username})))},x=a(161),z=a(234),A=a(109),R=a.n(A),U=a(229),B=a(508),J=a(511),L=a(513),_=a(230),q=a.n(_),W=(a(436),null),G=function(e){var t,r=Object(s.useRecoilValue)(N),o=Object(n.useState)(""),l=Object(m.a)(o,2),i=l[0],u=l[1],d=Object(n.useState)([]),f=Object(m.a)(d,2),E=f[0],h=f[1],y=Object(n.useState)(void 0),S=Object(m.a)(y,2),O=S[0],k=S[1],j=Object(n.useState)({}),w=Object(m.a)(j,2),T=w[0],I=w[1],C=Object(n.useState)(!1),A=Object(m.a)(C,2),_=A[0],G=A[1],M=Object(n.useState)([]),V=Object(m.a)(M,2),F=V[0],H=V[1],K=Object(n.useState)([]),Y=Object(m.a)(K,2),$=Y[0],D=Y[1],Q=Object(n.useState)(""),X=Object(m.a)(Q,2),Z=X[0],ee=X[1];Object(n.useEffect)((function(){null===localStorage.getItem("accessToken")&&e.history.push("/login"),te(),ce()}),[]),Object(n.useEffect)((function(){var e;void 0!==O&&(console.log(O),(e=O.id,localStorage.getItem("accessToken")?b({url:v+"/api/chat-messages/".concat(e),method:"GET"}):Promise.reject("No access token set.")).then((function(e){return console.log(e),I(e)})),ce())}),[O]);var te=function(){var e=a(437),t=a(444);t=new t("http://78.24.223.206:8082/ws"),(W=e.over(t)).connect({Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))},function(){var e=Object(U.a)(R.a.mark((function e(t){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Connected to WebSocket"),W.subscribe("/user/".concat(r.username,"/queue/notifications"),ae);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),W.onerror=function(e){console.log("WebSocket Error:",e)},W.onclose=function(){console.log("Connection closed")}},ae=function(e){var t=JSON.parse(e.body);console.log(t),ce()},ne=function(e){if(""!==e.trim()){var t={chatId:O.id,content:e};W.send("/app/chat.sendMessage",{},JSON.stringify(t));var a=Object(z.a)(T.content);a.push(t),I(Object(x.a)(Object(x.a)({},T),{},{content:a}))}},ce=function(){(localStorage.getItem("accessToken")?b({url:v+"/api/chat-rooms/my",method:"GET"}):Promise.reject("No access token set.")).then((function(e){return Promise.all(e).then((function(e){h(e),console.log(e),void 0===O&&e.length>0&&k(e[0])}))}))};return c.a.createElement("div",{id:"frame"},c.a.createElement("div",{id:"sidepanel"},c.a.createElement("div",{id:"profile"},c.a.createElement("div",{className:"wrap"},c.a.createElement("img",{id:"profile-img",src:P.a,className:"online",alt:""}),c.a.createElement("p",null,r.username),c.a.createElement("div",{id:"status-options"},c.a.createElement("ul",null,c.a.createElement("li",{id:"status-online",className:"active"},c.a.createElement("span",{className:"status-circle"})," ",c.a.createElement("p",null,"Online")),c.a.createElement("li",{id:"status-away"},c.a.createElement("span",{className:"status-circle"})," ",c.a.createElement("p",null,"Away")),c.a.createElement("li",{id:"status-busy"},c.a.createElement("span",{className:"status-circle"})," ",c.a.createElement("p",null,"Busy")),c.a.createElement("li",{id:"status-offline"},c.a.createElement("span",{className:"status-circle"})," ",c.a.createElement("p",null,"Offline")))))),c.a.createElement("div",{id:"search"}),c.a.createElement("div",{id:"contacts"},c.a.createElement("ul",null,E.map((function(e,t){return c.a.createElement("li",{onClick:function(){return k(e)},className:O&&e.id===O.id?"contact active":"contact"},c.a.createElement("div",{class:"wrap"},c.a.createElement("span",{className:"contact-status online"}),c.a.createElement("img",{id:e.id,src:P.a,alt:""}),c.a.createElement("div",{class:"meta"},c.a.createElement("p",{class:"name"},e.name))))})))),c.a.createElement("div",{id:"bottom-bar"},c.a.createElement("button",{onClick:function(){e.history.push("/")},id:"addcontact"},c.a.createElement("i",{className:"fa fa-user fa-fw","aria-hidden":"true"})," ",c.a.createElement("span",null,"Profile")),c.a.createElement("button",{onClick:function(){(localStorage.getItem("accessToken")?b({url:v+"/api/users",method:"GET"}):Promise.reject("No access token set.")).then((function(e){H(e),D([]),ee(""),G(!0)}))},id:"settings"},c.a.createElement("i",{className:"fa fa-cog fa-fw","aria-hidden":"true"})," ",c.a.createElement("span",null,"Add chat")))),c.a.createElement("div",{className:"content"},c.a.createElement("div",{className:"contact-profile"},c.a.createElement("img",{src:O&&P.a,alt:""}),c.a.createElement("p",null,O&&O.name)),c.a.createElement(q.a,{className:"messages"},c.a.createElement("ul",null,null===(t=T.content)||void 0===t?void 0:t.map((function(e){return c.a.createElement("li",{className:e.sender.id!==r.id?"replies":"sent"},c.a.createElement("p",null,e.content),console.log(e,T))})))),c.a.createElement("div",{className:"message-input"},c.a.createElement("div",{className:"wrap"},c.a.createElement("input",{name:"user_input",size:"large",placeholder:"Write your message...",value:i,onChange:function(e){return u(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(ne(i),u(""))}}),c.a.createElement(p.a,{icon:c.a.createElement("i",{class:"fa fa-paper-plane","aria-hidden":"true"}),onClick:function(){ne(i),u("")}})))),c.a.createElement(J.a,{title:"Select users to chat with",visible:_,onCancel:function(){return G(!1)},onOk:function(){var e;0!==$.length?""!==Z.trim()?(1===$.length?(e={name:Z,user_id:$[0]},localStorage.getItem("accessToken")?b({url:v+"/api/chat-rooms/private",method:"POST",body:JSON.stringify(e)}):Promise.reject("No access token set.")):function(e){return localStorage.getItem("accessToken")?b({url:v+"/api/chat-rooms/group",method:"POST",body:JSON.stringify(e)}):Promise.reject("No access token set.")}({name:Z,member_ids:$})).then((function(){B.a.success("Chat created"),G(!1),ce()})).catch((function(e){console.error(e),B.a.error("Could not create chat")})):B.a.warning("Please enter a chat name"):B.a.warning("Select at least one user")},okText:"Create chat"},c.a.createElement(g.a,{placeholder:"Enter chat name",value:Z,onChange:function(e){return ee(e.target.value)},style:{marginBottom:16}}),c.a.createElement(L.a.Group,{style:{width:"100%"},value:$,onChange:function(e){D(e)}},F.map((function(e){return c.a.createElement(L.a,{key:e.id,value:e.id,style:{display:"block",margin:"8px 0"}},e.username)})))))},M=(a(504),c.a.createContext(),function(e){return c.a.createElement("div",{className:"App"},c.a.createElement(y.HashRouter,null,c.a.createElement(i.Switch,null,c.a.createElement(i.Route,{exact:!0,path:"/",render:function(e){return c.a.createElement(C,e)}}),c.a.createElement(i.Route,{exact:!0,path:"/login",render:function(e){return c.a.createElement(S,e)}}),c.a.createElement(i.Route,{exact:!0,path:"/signup",render:function(e){return c.a.createElement(O,e)}}),c.a.createElement(i.Route,{exact:!0,path:"/chat",render:function(e){return c.a.createElement(G,e)}}))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var V=Object(l.a)([],{key:"recoil-persist",storage:sessionStorage}),F=V.RecoilPersist,H=V.updateState;o.a.render(c.a.createElement(s.RecoilRoot,{initializeState:H},c.a.createElement(F,null),c.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},78:function(e,t,a){e.exports=a.p+"static/media/user.1f0a44cd.png"}},[[240,1,2]]]);
//# sourceMappingURL=main.fa3c65b5.chunk.js.map