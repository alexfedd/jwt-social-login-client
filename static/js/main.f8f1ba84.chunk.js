(this["webpackJsonpjwt-social-login-client"]=this["webpackJsonpjwt-social-login-client"]||[]).push([[0],{241:function(e,t,a){e.exports=a(505)},269:function(e,t,a){},270:function(e,t,a){},382:function(e,t,a){},383:function(e,t,a){},435:function(e,t,a){},503:function(e,t,a){},505:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(5),o=a.n(r),s=a(35),l=a(218),i=(a(269),a(234)),m=a(19),u=a(31),d=a(514),g=a(509),p=a(512),f=a(51),E=a(515),h=a(516),v=a(517),b="http://78.24.223.206:8082",y=function(e){var t=new Headers;!1!==e.setContentType&&t.append("Content-Type","application/json"),localStorage.getItem("accessToken")&&t.append("Authorization","Bearer "+localStorage.getItem("accessToken"));var a={headers:t};return e=Object.assign({},a,e),fetch(e.url,e).then((function(e){return null===e||void 0===e?void 0:e.json().then((function(t){return e.ok?t:Promise.reject(t)}))}))};a(270);var S=function(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),r=a[0],o=a[1];Object(n.useEffect)((function(){null!==localStorage.getItem("accessToken")&&e.history.push("/")}),[]);return c.a.createElement("div",{className:"login-container"},c.a.createElement(E.a,{style:{fontSize:50}}),c.a.createElement(g.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:function(t){var a;o(!0),(a=t,y({url:b+"/auth/sign-in",method:"POST",body:JSON.stringify(a)})).then((function(t){localStorage.setItem("accessToken",t.token),e.history.push("/"),o(!1)})).catch((function(e){401===e.status?d.a.error({message:"Error",description:"Username or Password is incorrect. Please try again!"}):d.a.error({message:"Error",description:e.message||"Sorry! Something went wrong. Please try again!"}),o(!1)}))}},c.a.createElement(g.a.Item,{name:"username",rules:[{required:!0,message:"Please input your Username!"}]},c.a.createElement(p.a,{size:"large",prefix:c.a.createElement(h.a,{className:"site-form-item-icon"}),placeholder:"Username"})),c.a.createElement(g.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"}]},c.a.createElement(p.a,{size:"large",prefix:c.a.createElement(v.a,{className:"site-form-item-icon"}),type:"password",placeholder:"Password"})),c.a.createElement(g.a.Item,null,c.a.createElement(f.a,{shape:"round",size:"large",htmlType:"submit",className:"login-form-button",loading:r},"Log in")),"Not a member yet? ",c.a.createElement("a",{href:"/signup"},"Sign up")))},O=(a(382),function(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),r=a[0],o=a[1];Object(n.useEffect)((function(){null!==localStorage.getItem("accessToken")&&e.history.push("/")}),[]);return c.a.createElement("div",{className:"login-container"},c.a.createElement(E.a,{style:{fontSize:50}}),c.a.createElement(g.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:function(t){var a;o(!0),(a=t,y({url:b+"/auth/sign-up",method:"POST",body:JSON.stringify(a)})).then((function(t){d.a.success({message:"Success",description:"Thank you! You're successfully registered. Please Login to continue!"}),console.log(t),localStorage.setItem("accessToken",null===t||void 0===t?void 0:t.token),e.history.push("/login"),o(!1)})).catch((function(e){d.a.error({message:"Error",description:e.message||"Sorry! Something went wrong. Please try again!"}),o(!1)}))}},c.a.createElement(g.a.Item,{name:"username",rules:[{required:!0,message:"Please input your Username!"}]},c.a.createElement(p.a,{size:"large",placeholder:"Username"})),c.a.createElement(g.a.Item,{name:"email",rules:[{required:!0,message:"Please input your email!"}]},c.a.createElement(p.a,{size:"large",placeholder:"Email"})),c.a.createElement(g.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"}]},c.a.createElement(p.a,{size:"large",type:"password",placeholder:"Password"})),c.a.createElement(g.a.Item,null,c.a.createElement(f.a,{shape:"round",size:"large",htmlType:"submit",className:"login-form-button",loading:r},"Signup")),"Already a member? ",c.a.createElement("a",{href:"/login"},"Log in")))}),j=a(510),k=a(507),N=Object(s.atom)({key:"loggedInUser",default:{},persistence_UNSTABLE:{type:"loggedInUser"}}),w=(Object(s.atom)({key:"chatActiveContact",persistence_UNSTABLE:{type:"chatActiveContact"}}),Object(s.atom)({key:"chatMessages",default:[],persistence_UNSTABLE:{type:"chatMessages"}}),a(518)),T=a(79),P=a.n(T),I=(a(383),j.a.Meta),C=function(e){var t=Object(s.useRecoilState)(N),a=Object(u.a)(t,2),r=a[0],o=a[1];Object(n.useEffect)((function(){null===localStorage.getItem("accessToken")&&e.history.push("/login"),l()}),[]);var l=function(){(localStorage.getItem("accessToken")?y({url:b+"/auth/who-am-i",method:"POST"}):Promise.reject("No access token set.")).then((function(e){o(e)})).catch((function(e){console.log(e)}))};return c.a.createElement("div",{className:"profile-container"},c.a.createElement(j.a,{style:{width:420,border:"1px solid #e1e0e0"},actions:[c.a.createElement(w.a,{onClick:function(){localStorage.removeItem("accessToken"),e.history.push("/login")}})]},c.a.createElement(I,{avatar:c.a.createElement(k.a,{src:P.a,className:"user-avatar-circle"}),title:r.username,description:"@"+r.username})))},x=a(161),z=a(235),A=a(108),U=a.n(A),B=a(229),J=a(508),_=a(511),q=a(513),L=a(230),R=a.n(L),W=(a(435),null),G=function(e){var t,r=Object(s.useRecoilValue)(N),o=Object(n.useState)(""),l=Object(u.a)(o,2),i=l[0],m=l[1],d=Object(n.useState)([]),g=Object(u.a)(d,2),E=g[0],h=g[1],v=Object(n.useState)(void 0),S=Object(u.a)(v,2),O=S[0],j=S[1],k=Object(n.useState)({}),w=Object(u.a)(k,2),T=w[0],I=w[1],C=Object(n.useState)(!1),A=Object(u.a)(C,2),L=A[0],G=A[1],M=Object(n.useState)([]),V=Object(u.a)(M,2),F=V[0],H=V[1],K=Object(n.useState)([]),Y=Object(u.a)(K,2),$=Y[0],D=Y[1],Q=Object(n.useState)(""),X=Object(u.a)(Q,2),Z=X[0],ee=X[1];Object(n.useEffect)((function(){null===localStorage.getItem("accessToken")&&e.history.push("/login"),te(),ce()}),[]),Object(n.useEffect)((function(){var e;void 0!==O&&(console.log(O),(e=O.id,localStorage.getItem("accessToken")?y({url:b+"/api/chat-messages/".concat(e),method:"GET"}):Promise.reject("No access token set.")).then((function(e){return console.log(e),I(e)})),ce())}),[O]);var te=function(){var e=a(436),t=a(443);t=new t("http://78.24.223.206:8082/ws"),(W=e.over(t)).connect({Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))},function(){var e=Object(B.a)(U.a.mark((function e(t){return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Connected to WebSocket"),W.subscribe("/user/".concat(r.username,"/queue/notifications"),ae);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),W.onerror=function(e){console.log("WebSocket Error:",e)},W.onclose=function(){console.log("Connection closed")}},ae=function(e){var t=JSON.parse(e.body);console.log(t),ce()},ne=function(e){if(""!==e.trim()){var t={chatId:O.id,content:e};W.send("/app/chat.sendMessage",{},JSON.stringify(t));var a=Object(z.a)(T.content);a.push(t),I(Object(x.a)(Object(x.a)({},T),{},{content:a}))}},ce=function(){(localStorage.getItem("accessToken")?y({url:b+"/api/chat-rooms/my",method:"GET"}):Promise.reject("No access token set.")).then((function(e){return Promise.all(e).then((function(e){h(e),console.log(e),void 0===O&&e.length>0&&j(e[0])}))}))};return c.a.createElement("div",{id:"frame"},c.a.createElement("div",{id:"sidepanel"},c.a.createElement("div",{id:"profile"},c.a.createElement("div",{className:"wrap"},c.a.createElement("img",{id:"profile-img",src:P.a,className:"online",alt:""}),c.a.createElement("p",null,r.username),c.a.createElement("div",{id:"status-options"},c.a.createElement("ul",null,c.a.createElement("li",{id:"status-online",className:"active"},c.a.createElement("span",{className:"status-circle"})," ",c.a.createElement("p",null,"Online")),c.a.createElement("li",{id:"status-away"},c.a.createElement("span",{className:"status-circle"})," ",c.a.createElement("p",null,"Away")),c.a.createElement("li",{id:"status-busy"},c.a.createElement("span",{className:"status-circle"})," ",c.a.createElement("p",null,"Busy")),c.a.createElement("li",{id:"status-offline"},c.a.createElement("span",{className:"status-circle"})," ",c.a.createElement("p",null,"Offline")))))),c.a.createElement("div",{id:"search"}),c.a.createElement("div",{id:"contacts"},c.a.createElement("ul",null,E.map((function(e,t){return c.a.createElement("li",{onClick:function(){return j(e)},className:O&&e.id===O.id?"contact active":"contact"},c.a.createElement("div",{class:"wrap"},c.a.createElement("span",{className:"contact-status online"}),c.a.createElement("img",{id:e.id,src:P.a,alt:""}),c.a.createElement("div",{class:"meta"},c.a.createElement("p",{class:"name"},e.name))))})))),c.a.createElement("div",{id:"bottom-bar"},c.a.createElement("button",{onClick:function(){e.history.push("/")},id:"addcontact"},c.a.createElement("i",{className:"fa fa-user fa-fw","aria-hidden":"true"})," ",c.a.createElement("span",null,"Profile")),c.a.createElement("button",{onClick:function(){(localStorage.getItem("accessToken")?y({url:b+"/api/users",method:"GET"}):Promise.reject("No access token set.")).then((function(e){H(e),D([]),ee(""),G(!0)}))},id:"settings"},c.a.createElement("i",{className:"fa fa-cog fa-fw","aria-hidden":"true"})," ",c.a.createElement("span",null,"Add chat")))),c.a.createElement("div",{className:"content"},c.a.createElement("div",{className:"contact-profile"},c.a.createElement("img",{src:O&&P.a,alt:""}),c.a.createElement("p",null,O&&O.name)),c.a.createElement(R.a,{className:"messages"},c.a.createElement("ul",null,null===(t=T.content)||void 0===t?void 0:t.map((function(e){return c.a.createElement("li",{className:e.sender.id!==r.id?"replies":"sent"},c.a.createElement("p",null,e.content),console.log(e,T))})))),c.a.createElement("div",{className:"message-input"},c.a.createElement("div",{className:"wrap"},c.a.createElement("input",{name:"user_input",size:"large",placeholder:"Write your message...",value:i,onChange:function(e){return m(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(ne(i),m(""))}}),c.a.createElement(f.a,{icon:c.a.createElement("i",{class:"fa fa-paper-plane","aria-hidden":"true"}),onClick:function(){ne(i),m("")}})))),c.a.createElement(_.a,{title:"Select users to chat with",visible:L,onCancel:function(){return G(!1)},onOk:function(){var e;0!==$.length?""!==Z.trim()?(1===$.length?(e={name:Z,user_id:$[0]},localStorage.getItem("accessToken")?y({url:b+"/api/chat-rooms/private",method:"POST",body:JSON.stringify(e)}):Promise.reject("No access token set.")):function(e){return localStorage.getItem("accessToken")?y({url:b+"/api/chat-rooms/group",method:"POST",body:JSON.stringify(e)}):Promise.reject("No access token set.")}({name:Z,member_ids:$})).then((function(){J.a.success("Chat created"),G(!1),ce()})).catch((function(e){console.error(e),J.a.error("Could not create chat")})):J.a.warning("Please enter a chat name"):J.a.warning("Select at least one user")},okText:"Create chat"},c.a.createElement(p.a,{placeholder:"Enter chat name",value:Z,onChange:function(e){return ee(e.target.value)},style:{marginBottom:16}}),c.a.createElement(q.a.Group,{style:{width:"100%"},value:$,onChange:function(e){D(e)}},F.map((function(e){return c.a.createElement(q.a,{key:e.id,value:e.id,style:{display:"block",margin:"8px 0"}},e.username)})))))},M=(a(503),c.a.createContext(),function(e){return c.a.createElement("div",{className:"App"},c.a.createElement(i.a,null,c.a.createElement(m.c,null,c.a.createElement(m.a,{exact:!0,path:"/",render:function(e){return c.a.createElement(C,e)}}),c.a.createElement(m.a,{exact:!0,path:"/login",render:function(e){return c.a.createElement(S,e)}}),c.a.createElement(m.a,{exact:!0,path:"/signup",render:function(e){return c.a.createElement(O,e)}}),c.a.createElement(m.a,{exact:!0,path:"/chat",render:function(e){return c.a.createElement(G,e)}}))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var V=Object(l.a)([],{key:"recoil-persist",storage:sessionStorage}),F=V.RecoilPersist,H=V.updateState;o.a.render(c.a.createElement(s.RecoilRoot,{initializeState:H},c.a.createElement(F,null),c.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},79:function(e,t,a){e.exports=a.p+"static/media/user.1f0a44cd.png"}},[[241,1,2]]]);
//# sourceMappingURL=main.f8f1ba84.chunk.js.map